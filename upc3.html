<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Made on Vibes DIY</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
      }
      #container {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script>
      window.CALLAI_API_KEY = "sk-vibes-proxy-managed";
      window.CALLAI_CHAT_URL = "https://vibes-diy-api.com/";
      window.CALLAI_IMG_URL = "https://vibes-diy-api.com/";
    </script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@19.1.1/es2022/react.mjs",
          "react-dom": "https://esm.sh/react-dom@19.1.1/es2022/react-dom.mjs",
          "react-dom/client": "https://esm.sh/react-dom@19.1.1/es2022/client.mjs",
          "use-fireproof": "https://esm.sh/use-fireproof@0.23.11?external=react,react-dom",
          "call-ai": "https://esm.sh/call-ai",
          "use-vibes": "https://esm.sh/use-vibes",
          "three": "https://esm.sh/three"
        }
      }
    </script>
    <script type="text/babel" data-type="module">
      import ReactDOMClient from "react-dom/client";

      // prettier-ignore
      import React, { useState, useEffect } from "react"

export default function App() {
  const [title, setTitle] = useState("")
  const [header, setHeader] = useState("")
  const [content, setContent] = useState("")
  const [previewHTML, setPreviewHTML] = useState(null)

  useEffect(() => {
    const params = new URLSearchParams(window.location.search)
    const fileUrl = params.get('file')
    
    if (fileUrl) {
      fetch(fileUrl)
        .then(response => response.blob())
        .then(blob => {
          const url = URL.createObjectURL(blob)
          const printWindow = window.open(url, '_blank')
          if (printWindow) {
            printWindow.addEventListener('load', () => {
              printWindow.print()
              setTimeout(() => URL.revokeObjectURL(url), 1000)
            })
          }
        })
        .catch(err => console.error('Error loading file:', err))
    }
  }, [])

  const handleFileUpload = (e) => {
    const file = e.target.files[0]
    if (file) {
      const fileURL = URL.createObjectURL(file)
      const printWindow = window.open(fileURL, '_blank')
      if (printWindow) {
        printWindow.addEventListener('load', () => {
          printWindow.print()
          setTimeout(() => URL.revokeObjectURL(fileURL), 1000)
        })
      }
    }
  }

  const generatePrintHTML = (jobTitle, jobHeader, jobContent) => {
    const lines = jobContent.split('\n')
    const linesPerPage = 45
    const pages = []
    
    for (let i = 0; i < lines.length; i += linesPerPage) {
      pages.push(lines.slice(i, i + linesPerPage))
    }

    return `<!DOCTYPE html><html><head><style>@page{margin:1in}body{font-family:Georgia,serif;font-size:12pt;line-height:1.6;margin:0;padding:0}.page{page-break-after:always;position:relative;min-height:9in;padding-top:40px}.page:last-child{page-break-after:auto}.header{position:absolute;top:0;left:0;right:0;padding-bottom:10px;border-bottom:2px solid #000;font-weight:bold;font-size:10pt}.page-number{position:absolute;bottom:20px;right:0;font-size:10pt;color:#666}.content{white-space:pre-wrap}.title{font-size:18pt;font-weight:bold;margin-bottom:20px;text-align:center}</style></head><body>${pages.map((pageLines, index) => `<div class="page">${jobHeader ? `<div class="header">${jobHeader}</div>` : ''}${index === 0 && jobTitle ? `<div class="title">${jobTitle}</div>` : ''}<div class="content">${pageLines.join('\n')}</div><div class="page-number">Page ${index + 1} of ${pages.length}</div></div>`).join('')}</body></html>`
  }

  const printTextContent = () => {
    if (!content.trim()) return
    
    const printWindow = window.open('', '_blank')
    if (printWindow) {
      printWindow.document.write(generatePrintHTML(title, header, content))
      printWindow.document.close()
      setTimeout(() => printWindow.print(), 100)
    }
  }

  const showPreview = () => {
    if (!content.trim()) return
    setPreviewHTML(generatePrintHTML(title, header, content))
  }

  return (
    <div className="min-h-screen bg-[#1a1a1a] flex items-center justify-center p-4">
      <div className="w-full max-w-xl bg-[#242424] rounded-lg overflow-hidden">
        {/* Header */}
        <div className="px-6 py-4 bg-[#2a2a2a] border-b border-[#3a3a3a]">
          <h1 className="text-lg font-semibold text-white">Print Formatter</h1>
          <p className="text-xs text-gray-400 mt-1">
            <em>Upload a file or enter text to print. Add a URL parameter <code className="text-gray-300">?file=https://...</code> to auto-print on load.</em>
          </p>
        </div>

        <div className="p-6 space-y-4">
          {/* File Upload */}
          <div>
            <label className="block text-xs font-medium text-gray-300 mb-1.5">Upload File</label>
            <input
              type="file"
              onChange={handleFileUpload}
              accept=".pdf,.doc,.docx,.txt,.jpg,.png"
              className="w-full text-sm text-gray-300 file:mr-3 file:py-1.5 file:px-3 file:rounded file:border-0 file:text-xs file:font-medium file:bg-[#3a3a3a] file:text-white hover:file:bg-[#4a4a4a] cursor-pointer bg-[#2a2a2a] border border-[#3a3a3a] rounded px-2 py-1.5"
            />
          </div>

          <div className="relative">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t border-[#3a3a3a]"></div>
            </div>
            <div className="relative flex justify-center">
              <span className="px-2 bg-[#242424] text-xs text-gray-500">or format text</span>
            </div>
          </div>

          {/* Text Form */}
          <div className="space-y-3">
            <div>
              <input
                type="text"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                placeholder="Title (optional)"
                className="w-full px-3 py-2 text-sm bg-[#2a2a2a] border border-[#3a3a3a] rounded text-white placeholder-gray-500 focus:outline-none focus:border-[#4a4a4a]"
              />
            </div>
            <div>
              <input
                type="text"
                value={header}
                onChange={(e) => setHeader(e.target.value)}
                placeholder="Header (optional)"
                className="w-full px-3 py-2 text-sm bg-[#2a2a2a] border border-[#3a3a3a] rounded text-white placeholder-gray-500 focus:outline-none focus:border-[#4a4a4a]"
              />
            </div>
            <div>
              <textarea
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder="Enter content..."
                rows={8}
                className="w-full px-3 py-2 text-sm bg-[#2a2a2a] border border-[#3a3a3a] rounded text-white placeholder-gray-500 font-mono resize-none focus:outline-none focus:border-[#4a4a4a]"
              />
            </div>
            
            <div className="flex gap-2">
              <button
                onClick={printTextContent}
                disabled={!content.trim()}
                className="flex-1 bg-white text-[#242424] text-sm font-medium py-2 rounded hover:bg-gray-100 disabled:opacity-30 disabled:cursor-not-allowed transition-all"
              >
                Print
              </button>
              <button
                onClick={showPreview}
                disabled={!content.trim()}
                className="flex-1 bg-[#3a3a3a] text-white text-sm font-medium py-2 rounded hover:bg-[#4a4a4a] disabled:opacity-30 disabled:cursor-not-allowed transition-all"
              >
                Preview
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* Preview Modal */}
      {previewHTML && (
        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div className="flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50">
              <h3 className="text-sm font-semibold text-gray-900">Preview</h3>
              <div className="flex gap-2">
                <button
                  onClick={printTextContent}
                  className="px-3 py-1.5 text-xs font-medium bg-[#242424] text-white rounded hover:bg-[#1a1a1a]"
                >
                  Print
                </button>
                <button
                  onClick={() => setPreviewHTML(null)}
                  className="px-3 py-1.5 text-xs font-medium bg-gray-200 text-gray-700 rounded hover:bg-gray-300"
                >
                  Close
                </button>
              </div>
            </div>
            <div 
              className="p-8 overflow-auto max-h-[calc(90vh-60px)] bg-white"
              dangerouslySetInnerHTML={{ __html: previewHTML }}
            />
          </div>
        </div>
      )}
    </div>
  )
}
      // prettier-ignore-end

      const rootElement = document.getElementById("container");
      ReactDOMClient.createRoot(rootElement).render(<App />);
    </script>
    <!--
    Agents see LLMs docs:
      Database: https://use-fireproof.com/llms-full.txt 
      CallAI: https://use-fireproof.com/callai-llms.txt
      ImgGen: https://use-fireproof.com/imggen-llms.txt
    -->
  </body>
</html>
